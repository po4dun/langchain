<!DOCTYPE html>
<html>
    <head>
        <title>DataWarehouse : Validate input lists from studies</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="DataWarehouse_33423377.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="FAQ-CDWH-Analysis_33424229.html">FAQ CDWH Analysis</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DataWarehouse : Validate input lists from studies
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Fabian Franzeck</span>, last modified on M채rz 13, 2023
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Many studies send list of e.g. PIDs and FIDs for us to query specific data for. These lists often contain wrong or outdated IDs and before every query on our side, those data quality problems should be corrected by them.</p></div></div><p>This SQL validates a list of PIDs and FIDs (exemplary dummy data in the FROM - replace with your real data) and indicates the relevant dataquality problem:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">SELECT
    a.id,
    a.pid,
    a.fid,
    CASE WHEN p.pat_bk IS NULL THEN 1 ELSE 0 END AS pid_not_exist,
    CASE WHEN p.PAT_MERGE_FLAG IS NULL THEN 0 ELSE p.PAT_MERGE_FLAG END AS pid_changed,
    CASE WHEN c2.cas_bk IS NULL THEN 1 else 0 END AS  fidpid_combo_not_exist,
    CASE WHEN c1.cas_bk IS NULL THEN 1 else 0 END AS  fid_not_exist,
    CASE WHEN c1.CAS_CANCELLATION_FLAG IS NULL THEN 0 ELSE c1.CAS_CANCELLATION_FLAG END  AS fid_cancelled
FROM
    (select &#39;0003730578&#39; AS PID, &#39;0087093658&#39; AS FID, &#39;STUDY-124237&#39; AS ID from dummy
    UNION
    select &#39;00037305780&#39; AS PID, &#39;0087094376&#39; AS FID, &#39;STUDY-345645&#39; AS ID from dummy
    UNION
    select &#39;0003906668&#39; AS PID, &#39;0088715085&#39; AS FID, &#39;STUDY-468235&#39; AS ID from dummy
    UNION
    select &#39;0003785314&#39; AS PID, &#39;0028715085&#39; AS FID, &#39;STUDY-745925&#39; AS ID from dummy) a
LEFT JOIN cdwh.v_il_dim_case_cid c1 ON
    a.fid = c1.cas_bk
LEFT JOIN cdwh.v_il_dim_case_cid c2 ON
    a.fid = c2.cas_bk
    AND a.pid = c2.PAT_BK
LEFT JOIN cdwh.v_il_dim_patient_cid p ON
    a.pid = p.PAT_BK
WHERE
    (
    0 = 1
    OR c1.cas_bk IS NULL  --  F채lle aus dem Input, die nicht existieren
    OR c2.cas_bk IS NULL  -- F채lle im Input, die entweder nicht existieren oder falsche PID/FID Combi im Input
    OR c1.CAS_CANCELLATION_FLAG = 1  -- F채lle aus dem Input, die mittlerweise storniert wurden
    OR p.PAT_MERGE_FLAG = 1 -- sind im Input zwischenzeitlich gemergte PIDs?
    OR p.pat_bk IS NULL  -- nicht-existente PIDs im Input?
    );</pre>
</div></div><p /><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Okt. 26, 2023 18:02</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
