<!DOCTYPE html>
<html>
    <head>
        <title>DataWarehouse : Research consent data</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="DataWarehouse_33423377.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="FAQ-CDWH-Analysis_33424229.html">FAQ CDWH Analysis</a></span>
                            </li>
                                                    <li>
                                <span><a href="257425449.html">Research consent / Forschungskonsent</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DataWarehouse : Research consent data
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Fabian Franzeck</span>, last modified on Dez. 15, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p class="auto-cursor-target">Any patient can have multiple general research consent ('Generalforschungskonsent') decisions over time. Commonly, the last valid consent decision of a subject is used to indicate consent for research projects (however, this has to be specified by the principal investigator of a study). V_IL_DIM_CONSENT_CID also contains duplicates on PAT_BK (depicting the multiple possible consent decisions). Furthermore, it does not contain dummy records for subjects without any research consent (which make up roughly 50% of all patients). Because of these aspects, there is commonly a LEFT JOIN necessary and a preselection on the last valid Consent decision by PAT_BK.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">SELECT
    a.pat_bk,
    CASE
        WHEN consent.con_value = &#39;Ja&#39; THEN &#39;consented&#39;
        WHEN consent.con_value = &#39;Nein&#39; THEN &#39;refused&#39;
        WHEN consent.con_value IS NULL
        OR consent.con_value = &#39;n.a.&#39; THEN &#39;no_decision&#39;
        ELSE consent.con_value
    END AS general_consent_decision
FROM CDWH.V_IL_DIM_PATIENT_CUR a  ---  or any other table with patientids you want to check the consentstatus from
LEFT JOIN (SELECT *
                  FROM   (SELECT *,
                                 Cast(row_number()
                                        OVER (
                                          partition BY PAT_BK
                                          ORDER BY CON_VALID_FROM_DATE DESC , CON_VALID_TO_DATE DESC) AS
                                      SMALLINT) AS
                                 sorter
                          FROM   cdwh.v_il_dim_consent_cid
                          WHERE  CON_TYPE_NK = &#39;Allgemeiner Forschungsconsent&#39;
                                 AND CON_IS_ACTIVE = 1
                                 AND DWH_IS_DELETED &lt;&gt; 1
                                 AND CURRENT_DATE &lt; CON_VALID_TO_DATE)
                  WHERE  SORTER = 1) consent
    on a.pat_bk=consent.pat_bk;</pre>
</div></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Okt. 26, 2023 18:02</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
