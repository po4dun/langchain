<!DOCTYPE html>
<html>
    <head>
        <title>DataWarehouse : Duration from START to END or until ALT date, if before END</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="DataWarehouse_33423377.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="FAQ-CDWH-Analysis_33424229.html">FAQ CDWH Analysis</a></span>
                            </li>
                                                    <li>
                                <span><a href="SAP-HANA-stuff_257359936.html">SAP HANA stuff</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DataWarehouse : Duration from START to END or until ALT date, if before END
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicole Goebel</span>, last modified on Mai 25, 2023
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>Duration of ICU stay before SAMPLE_DATE</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">SELECT
	ID, ROUND(sum(seconds)/(60 * 60 * 24), 1) AS DAYS_ON_ICU_BEFORE_SAMPLING
FROM
	(
		SELECT
			g.ID, g.cas_bk, SO_BEGIN, SO_END, g.SAMPLE_DATE_TIME
--			, SECONDS_BETWEEN(SO_BEGiN, SO_END) AS seconds					--Dauer ICU von Anfang bis Ende
			, SECONDS_BETWEEN(SO_BEGiN, LEAST(SAMPLE_DATE_TIME, SO_END)) AS seconds	--Dauer ICU von Anfang bis Ende oder bis Sample_Date
		FROM	GOEBELN.TICKET_21946_FID AS g		
		JOIN 	cdwh.V_DM_FCT_STAY_BY_ORG AS b ON g.cas_bk = b.cas_bk
			AND (g.SAMPLE_DATE_TIME &gt; SO_END							--wenn zeitlich komplett vor Sampling:	|---ICU---|	|---ICU---|	sample_date
				OR g.SAMPLE_DATE_TIME BETWEEN SO_Begin AND SO_END)			--wenn Sampling innerhalb ICU stay: 	|---ICU---sample_date---|
			AND SO_ASSIGN_ORG_BK IN (&#39;00004600&#39;, &#39;00004602&#39;, &#39;00004170&#39;)
	)
GROUP BY ID
ORDER BY ID</pre>
</div></div><p /><p>Duration of mechanical ventilation before SAMPLE_DATE</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">SELECT
	ID, ROUND(sum(seconds)/(60 * 60 * 24), 1) AS DAYS_ON_MECH_VENT_BEF_SAMPL
FROM
	(
		SELECT
			g.ID, g.cas_bk, OSPM_FROM_DATE_TS, OSPM_UNTIL_DATE_TS, g.SAMPLE_DATE_TIME
--			, SECONDS_BETWEEN(OSPM_FROM_DATE_TS, OSPM_UNTIL_DATE_TS) AS seconds					--Dauer Beatmung von Anfang bis Ende
			, SECONDS_BETWEEN(OSPM_FROM_DATE_TS, LEAST(SAMPLE_DATE_TIME, OSPM_UNTIL_DATE_TS)) AS seconds	--Dauer Beatmung von Anfang bis Ende oder bis Sample_Date
		FROM	GOEBELN.TICKET_21946_FID AS g
		JOIN 	CDWH.V_IL_FCT_ORGANSUPPORT_PROCEDURE_METAVISION m ON g.cas_bk = m.cas_bk
			AND (g.SAMPLE_DATE_TIME &gt; OSPM_UNTIL_DATE_TS 									--wenn zeitlich komplett vor Sampling:	|---BEA---|	|---BEA---|	sample_date
				OR g.SAMPLE_DATE_TIME BETWEEN  OSPM_FROM_DATE_TS AND OSPM_UNTIL_DATE_TS)			--wenn Sampling innerhalb Beatmung: 	|---BEA---sample_date---|
			AND osp_bk =&#39;MET|5973&#39;
	)
GROUP BY ID	
ORDER BY ID</pre>
</div></div><p /><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Okt. 26, 2023 18:02</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
