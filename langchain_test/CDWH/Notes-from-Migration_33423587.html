<!DOCTYPE html>
<html>
    <head>
        <title>DataWarehouse : Notes from Migration</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="DataWarehouse_33423377.html">DataWarehouse</a></span>
                            </li>
                                                    <li>
                                <span><a href="Wiki_33424094.html">Wiki</a></span>
                            </li>
                                                    <li>
                                <span><a href="Application-documentation_33424138.html">Application documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="HANA_33424112.html">HANA</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DataWarehouse : Notes from Migration
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Fabian Franzeck</span> on Juni 08, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <ul><li>Use NVACHAR for any VARCHAR from Source Systems<br/>Link zum Video: <a href="https://events.sap.com/teched/en/session/51549" class="external-link" rel="nofollow">https://events.sap.com/teched/en/session/51549</a></li></ul><ul><li>which version do we use?</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">select * from M_DATABASE;
-- 2.00.044.00.1571081837
-- HANA 2.00, SP04, Rev 4, Patch 00, Reference Build: 1571081837</pre>
</div></div><p><br/></p><ul><li>sql is a family of languages</li><li>independent if db is sql-92 or not (there are different level of ansi, 92 is a very small set of definition - so basically every dbms is compatible with sql-92)</li><li>SQLScript: name of grouping sql commands together</li><li>sql vs sqlscript:<ul><li>sql: commands</li><li>sqlscripts: exception handling etc.</li><li>query plan can be different for sql and sqlscript</li></ul></li><li>context<ul><li>stored procedures: server side code</li><li>block &quot;do begin / end&quot;: like a temporary stored procedures -&gt; same context</li></ul></li><li>mythos &quot;sqlscript is not recommended&quot;<ul><li>it's only not recommended for sap application - for hana itself it's ok</li></ul></li><li>use sqlscript only with hana 2 SP04 / (rev31) and later (we don't have this, only rev 4 see at top)</li><li>hdbsql: simplest and universal tools<ul><li>-I for input a file</li><li>-m for multiline</li><li>change delimiter to custom f.e. &quot;go&quot;</li><li>-strictseparatorline use!</li><li>-fn: adds linenumbers to output</li></ul></li><li>bug: don't use /**/ for comments, its suppressed the output. use &quot;--&quot; instead</li><li>do not use fix-length (n)char use varchar etc...<ul><li>(but then you have the issue with trailing spaces (they handled &quot;normally&quot;): &quot;a&quot; is not the same like &quot;a &quot;)</li><li>length: max is 5'000 for column / 8MB for variables/parameters (in run context)</li></ul></li><li>strings:<ul><li>for generating data use LPAD() / RPAD()</li><li>concat with ||<ul><li>in queries max is 255 terms</li><li>in sqlscript you get other errors, but there is no limit</li></ul></li><li>comparison is case sensitive</li></ul></li><li>null<ul><li>concat null, will end in a full null string (if something is null everything is null [unknown])</li><li><strong>IMPORTANT:</strong> be careful with declared variables, coz they are always initialized with null. so if you concat more values the null is dominating everything. (e.g. build string in a loop - good habbit anyway, to initialize at the begin with an empty string instead of only the declaration)</li><li>fix: use ifnull if you have this problem</li></ul></li><li>select resultsets<ul><li>differences between &quot;select ..&quot; / &quot;CALL p()&quot;<ul><li>only implicit (not nested) resultsets are sent to the client</li><li>set carry_nested_implicit_result = true, for getting all the implicit resultsets back to the client</li></ul></li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ALTER SYSTEM ALTER CONFIGURATION (&#39;indexserver.ini&#39;, &#39;system&#39;)
SET (&#39;sqlscript&#39;, &#39;carry_nested_implicit_result&#39;) = &#39;true&#39;
WITH RECONFIGURE;</pre>
</div></div></li></ul><ul><li>autonomous transaction: will be run in a seperate connection<ul><li>there is no way to get the output back</li></ul></li><li>in case of &quot;rollback/exception&quot;: no data are sent back to the client (also not for select statements before)<ul><li>the reason is multiversioning concurrency control (MVCC) -&gt; creates always new versions (add a state change)</li><li>so the rollback revert the full version (include the select)</li><li><strong>IMPORTANT:</strong> same effect is for unhandled exceptions</li><li>so you can not really debug with implicit selects, you have to<ul><li>log to table (autonomous transaction) or</li><li>print debugging messages (also possible for resultsets - a print can not been reverted)</li></ul></li></ul></li><li>recursion:<ul><li>since sp04, direct recursion are supported (func calls itself) (but not indirect [func1 calls func2, func2 calls func1]) - chicken / egg problem</li><li>function: there is no nested limitation</li><li>procedures: (are called with the keyword &quot;CALL&quot;) there is a nested limitation (31)</li></ul></li><li>triggers/function<ul><li>for scalar user defined functions (SUDF)<ul><li>it's not allowed: ddl, transaction mgmt, execute immediate</li><li>even if you call a procedure there from a function (there will be a full function generated - performance)</li></ul></li><li>for triggers:<ul><li>it's not allowed: rollback (there are workarounds), to modifying the base table</li><li>mark proc with &quot;read sql data&quot; (additional proc syntax in head), if you want to use a proc in a func</li></ul></li></ul></li><li>Memory Usage<ul><li>procedures: query plan per call will be cached, per call one cache. -&gt; out of memory<ul><li>not if you bind the params (-- bind params)</li><li>OR use: WITH HINT (IGNORE_PLAN_CACHE)</li></ul></li></ul></li><li>Table Variables / Types<ul><li>type table can be used like a table</li><li>can be passing to procedures / function (as &quot;table(...)&quot;)</li><li>create type -&gt; allows to define temporary tables</li></ul></li><li>sqlscript specific config settings to 'silent' (to avoid unnecessary warnings)<ul><li>dynamic_sql_ddl_error_level</li><li>sudf_support_level_select_into</li><li>sudf_support_level_cursor</li><li>sudf_support_level_proc_call</li><li>support_level_set_session_in_read_only</li></ul></li><li>delimited identifiers<ul><li>hana identifier (for tables, proc, funcs etc.) are case-insensitive by default</li><li>if you put quotes around identifiert, it will get case sensitive -&gt; so called delimited identifiers</li><li><strong>IMPORTANT:</strong> don't use this in general! (even in hana documentation is always with quotes)</li><li>you can use 7-bit ascii chars, even with # and $ (but not on first place)</li><li><em>special:</em> local tmporary tables must have # at the beginning</li></ul></li><li>::ROWCOUNT you get the amount of changed records (dml)<ul><li>only in sqlscript</li><li>not after truncate (then it will be always 1)</li></ul></li><li>create tables as (select)<ul><li>does not work with variables in the script</li><li>workaround: use a table type for the select and do the create with a select from this type</li></ul></li><li>Triggers with Rollback<ul><li>use &quot;signal&quot; instead</li></ul></li><li>Authorization errors<ul><li>insufficient privilege errors are without details by default</li><li><p class="auto-cursor-target">but you get an hash, with them call: (you need execute permission to this function)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">CALL SYS.GET_INSUFFICIENT_PRIVILEGE_ERROR_DETAILS(&#39;HASH&#39;, ?)</pre>
</div></div></li></ul></li></ul><pre><code class="language-sql">
</code></pre>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Okt. 26, 2023 18:02</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
